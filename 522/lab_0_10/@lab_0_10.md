# HISTO Project
## VIDEO -A-
### Create Folder Structure
- [ ] ../HISTO/
- [ ] ../HISTO/C_code/
- [ ] ../HISTO/VHDL/
- [ ] ../HISTO/Vivado/
### Web Copy 
- [ ] 522/lab_0_10/HISTO_Hardware_Demo_C_code.zip
- [ ] 522/lab_0_10/HISTO_Hardware_Demo_VHDL.zip
- [ ] confirm Histo.c, common.h, & ZYBO_C1_PN.txt

### Confirm file contents
- [ ] data types pack
- [ ] histo vhd
- [ ] load unload bram
- [ ] top vhd
- [ ] top xcd
- [ ] design wrapper
- [ ] controller vhd
### GPIO reuse
Lots of reuse between GPIO_BRAM and HISTO.
```
$ cp -rp GPIO ../../HISTO/Vivado/
```
```
$ rename GPIO_BRAM HISTO GPIO_BRAM.*
```
>__Note__
>Depending on OS, may have to change above to
> $ rename 's/GPIO_BRAM/HISTO/' GPIO_BRAM.*

### Run Vivado
From correct directory, HISTO, run vivado.  Can run in background with '&'
```
$ vivado&
```
### GUI sanity check
- [ ] OPEN file (HISTO.vhd), don't create new file
- [ ] explore 'sources', confirm path is to ../HISTO/ not ../GPIO_BRAM/
### Expect to add to sources...
- [ ] Controller.vhd
- [ ] Histo.vhd (HISTO 'project' exists, but needs to include HISTO.vhd provided by instructor)
warning: if 'top' does not correctly re-order itself, may need to rtclk and set top.
### Block diagram edit...
Cannot run design at 100 mhz (default frequency for project).  Edit FCLK_CLK0 inside block 'processing_system7_0'.  100 mhz would
require traversing datapath in 10 nanoseconds, our project takes more.  Cut the frequency in half to increase the time by 2x.  
- [ ] Double click on Zynq processing system block -> go to clock configuration -> select PL fabric clock -> note that FCLK_CLK0 @ 100Mhz.  CHange this to 50 MHz
Since this doesn't change any of the pins, 'design wrapper' does not need to change and be re uploaded.  But the block diagram DOES need to be re-validated.
- [ ] Genrate layout.
- [ ] Run Validation.
### ERROR WARNINGS
If you get a bunch of 'critical warnings' upon re-validation, it's likely a bug and can be ignored.
Can confirm by runing validation a second time.  If critical errors go away, no problem, continue on.
### Finalize
- [ ] Save block diagram and close block diagram editor
- [ ] Generate Bitstream (must do since added new files and changed block diagram)
- [ ] wait... synthesis should take awhile if all is correct
- [ ] logs, expect to see some warnings under Implementation Summary
- [ ] logs, confirm WNS worst negative slack timing ~ 4-5 nanoseconds
### END VIDEO -A-

## VIDEO -B-

### Warnings
Should be safe to ignore, most have been confirmed erroneous by xilinx (instructor using vivado 2017).

### Program the board
- [ ] Open hardware manager
- [ ] Autoconnect
- [ ] 'Program Device' (leave checkbox selected, use bitstream generated above)

### ELF File Creation pt 1 (SDK or Vitis)
- [ ] Export Hardware / Include Bitstream = TRUE
- [ ] Launch SDK or Launch Vitis
Note: have to do this twice.  First round creates a hardware platform, then we need to delete it.
- [ ] From Project Explorer, select all assets and delete from disk
- [ ] Once Project Explorer is empty, close project.
- [ ] Close Vitis
- [ ] From Vivado, Re-Export Hardware
- [ ] Re-Launch Vitis
- [ ] Confirm imported with only 'design_1_wrapper_hw_platform_0', no other assets

### ELF File Creation pt 2 (SDK or Vitis)
- [ ] Create Application Project
- [ ] Name: HISTO || os: linux || processor:ps7_coretxa9_0 || language:c || board support:create new
- [ ] Template: Linux Empty Application
- [ ] Change Compiler (IGNORE ON LATER VERSIONS OF VITIS)
- [ ] From Proj Exp -> HISTO -> rtclk and 'import' File System ../../HISTO/C_code/
- [ ] select 'common.h' and 'Histo.c' from imported ../../HISTO/C_code/ || Advanced -> Create Links in workspace -> check all true
- [ ] confirm src files added and binary ELF is created, should be HISTO.elf

### Connect to Board / Hardware
- [ ] Install SD Card
- [ ] Connect Ethernet Cable
- [ ] Connect MicroUSB
- [ ] Connect +5VDC Power Supply
- [ ] Turn on Board
- [ ] If using VM, confirm USB passthrough from host to VM
- [ ] Confirm USB device found ($ lsusb => FTDI or digilent device on bus)
- [ ] From terminal connect to serial...
```
minicom -s
```
```
zynq> ifconfig eth0 192.168.x.x netmask 255.255.255.0
```
- [ ] close minicom with CTRL-A / X
```
$ ssh root@192.168.x.x
```
Password:root
```
zynq> cd /
znyq> ls
```
FROM UBUNTU TERMINAL WINDOW...
```
$ scp HI
$ scp HISTO.sdk/HISTO/Debug/
$ scp HISTO.sdk/HISTO/Debug/HI
$ scp HISTO.skd/HISTO/Debug/HISTO.elf root@192.168.x.x:/
```
FROM ZYNQ TERMINAL WINDOW ...
- confirm file structure of / includes HISTO.elf
- change permissions of HISTO.elf to allow chmod 777

FROM UBUNTU TERMINAL WINDOW...
copy the datafile the same way (scp -> zynq)
from C_code directory
```
$ scp ZYBO_C1_PN.txt root@192.168.x.x.:/
```
FROM ZYNQ TERMINAL WINDOW ...
- confirm / includes data file.
- test run HISTO
```
zynq> ./HISTO.elf ZYBO_C1-PN.txt
```
- confirm result display fields of numbers on terminal screen.  Should produce a 'mean' and a 'range'

## END
- [ ] Screen capture the results of running HISTO.elf and submit via PDF to instructor.
